{"version":3,"sources":["injection.tokens.ts","helpers/log-factory.ts","services/config/config.service.ts","services/generic-runner/generic-runner.service.ts","services/database/database.service.ts","helpers/ensure-folder.ts","helpers/date.ts","templates/native.ts","templates/basic.ts","templates/typescript.ts","templates/index.ts","services/migrations-resolver/migrations-resolver.service.ts","helpers/error.ts","services/migration/migration.service.ts","helpers/args-extractors.ts","default.config.ts","migrations.module.ts","app.module.ts","main.ts"],"names":[],"mappings":"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","file":"main.js","sourceRoot":"../src","sourcesContent":["import { InjectionToken } from '@rxdi/core';\nimport { Db } from 'mongodb';\nimport { TemplateTypes } from './templates';\n\nexport interface ReturnType {\n  appliedAt: Date | string;\n  fileName: string;\n  result: any;\n}\n\nexport const LoggerConfig = new InjectionToken('logger-config');\nexport const Config = new InjectionToken('migrations-config');\nexport type MigrationSchema = {\n  down: (db: Db) => unknown;\n  up: (db: Db) => unknown;\n};\n\nexport interface LoggerConfig {\n  folder: string;\n  up: {\n    success: string;\n    error: string;\n  };\n  down: {\n    success: string;\n    error: string;\n  };\n}\n\nexport interface Config {\n  mongodb: {\n    url: string;\n    databaseName: string;\n    options: {\n      useNewUrlParser: true;\n    };\n  };\n  migrationsDir: string;\n  changelogCollectionName: string;\n  logger: LoggerConfig;\n  defaultTemplate?: TemplateTypes;\n}\n\nexport type Tasks = 'up' | 'down' | 'status' | 'create' | '--template' | '--fallback';\n\n\nexport const CommandInjector = new InjectionToken('CommandInjector');","import { Inject, Injectable } from '@rxdi/core';\nimport { LoggerConfig } from '../injection.tokens';\n\nimport { createWriteStream, WriteStream } from 'fs';\n\nclass Logger {\n  successLogger: WriteStream;\n  errorLogger: WriteStream;\n  constructor(successPath: string, errorPath: string) {\n    this.successLogger = createWriteStream(successPath, {\n      flags: 'a'\n    });\n    this.errorLogger = createWriteStream(errorPath, {\n      flags: 'a'\n    });\n  }\n  log(res: unknown) {\n    this.successLogger.write(this.getLogTemplate(res, 'ðŸš€'));\n  }\n  error(res: unknown) {\n    this.errorLogger.write(this.getLogTemplate(res, 'ðŸ”¥'));\n  }\n\n  getLogTemplate(res: unknown, emoji: string) {\n    return `\n${emoji} ********* ${new Date()} *********\n\\n${JSON.stringify(res, null, 2)}\n`;\n  }\n}\n\n@Injectable()\nexport class LogFactory {\n  loggers: Map<string, Logger> = new Map();\n\n  constructor(@Inject(LoggerConfig) private config: LoggerConfig) {}\n\n  getDownLogger() {\n    return this.create('down', this.getConfig('down'));\n  }\n\n  getUpLogger() {\n    return this.create('up', this.getConfig('up'));\n  }\n\n  getConfig(type: 'up' | 'down') {\n    return {\n      successPath: `${this.config.folder}/${this.config[type].success}`,\n      errorPath: `${this.config.folder}/${this.config[type].error}`\n    };\n  }\n\n  create(name: string, { successPath, errorPath }) {\n    if (this.has(name)) {\n      return this.get(name);\n    }\n    this.loggers.set(name, new Logger(successPath, errorPath));\n    return this.get(name);\n  }\n\n  has(name: string) {\n    return this.loggers.has(name);\n  }\n\n  get(name: string) {\n    return this.loggers.get(name);\n  }\n}\n","import { Injectable } from '@rxdi/core';\nimport { Config } from '../../injection.tokens';\n\n@Injectable()\nexport class ConfigService {\n  config: Config = {} as Config;\n\n  constructor(private initConfig: Config) {}\n\n  set(config: Config) {\n    this.config = Object.assign(config, this.initConfig);\n  }\n\n  get() {\n    return this.config;\n  }\n}\n","import { ReturnType, Tasks } from '../../injection.tokens';\nimport { normalize } from 'path';\nimport chalk from 'chalk';\nimport { LogFactory } from '../../helpers/log-factory';\nimport { Injectable } from '@rxdi/core';\nimport { MigrationService } from '../migration/migration.service';\nimport { ConfigService } from '../config/config.service';\n\n@Injectable()\nexport class GenericRunner {\n  tasks: Map<string, Function> = new Map();\n  constructor(\n    private logger: LogFactory,\n    private configService: ConfigService\n  ) {}\n\n  setTasks(tasks: any[]) {\n    this.tasks = new Map(tasks);\n  }\n  async run(name: Tasks, args?: any) {\n    await this.logEnvironment(name);\n    const logger = this.logger.getDownLogger();\n    if (!this.tasks.has(name)) {\n      throw new Error('\\nðŸ”¥  Missing command');\n    }\n    try {\n      const res = await this.tasks.get(name)(args);\n      if (res && res.status && res.result.length) {\n        console.log(`\n          \\nðŸ”¥  There are ${chalk.red(\n            res.result.length\n          )} migration with status '${chalk.red('PENDING')}' run '${chalk.green(\n          `xmigrate up`\n        )}' command!\n          `);\n      } else {\n        console.log(`\n        \\nðŸš€  ${chalk.green.bold(\n          res && res.length\n            ? `Success! Runned ${res.length} migrations.`\n            : 'Already up to date'\n        )}\n        `);\n      }\n\n      setTimeout(() => process.exit(0), 0);\n    } catch (e) {\n      console.error(`\n      \\nðŸ”¥  ${chalk.bold('Status: Operation executed with error')}\nðŸ§¨  ${chalk.bold('Error: ' + JSON.stringify(e))}\nðŸ“¨  ${chalk.bold('Message: ' + e.message)}\n      `);\n      if (args && args.fallback) {\n        try {\n          await this.fallback(e.fileName);\n        } catch (err) {\n          console.log('\\nðŸ”¥  Migration fallback exited with error  ', err);\n          logger.error({\n            errorMessage: err.message,\n            fileName: e.fileName\n          });\n        }\n      }\n      setTimeout(() => process.exit(1), 0);\n    }\n  }\n\n  async fallback(fileName: string) {\n    const response: ReturnType = {\n      fileName\n    } as any;\n    const logger = this.logger.getDownLogger();\n    const { migrationsDir } = this.configService.config;\n    const migrationPath = normalize(\n      `${process.cwd()}/${migrationsDir}/${fileName}`\n    );\n    console.log(`\n\\nðŸ™  ${chalk.bold('Status: Executing fallback operation')} ${chalk.red(\n      'xmigrate down'\n    )}\nðŸ“  ${chalk.bold('Migration:')} ${migrationPath}\n      `);\n    response.appliedAt = new Date();\n    response.result = await require(migrationPath).down();\n    console.log(\n      `\\nðŸš€  ${chalk.green(\n        'Fallback operation success, nothing changed if written correctly!'\n      )}`\n    );\n    logger.log(response);\n\n    return response;\n  }\n\n  bind(self: MigrationService) {\n    // Binds appropriate `this` to tasks\n    Array.from(this.tasks.keys()).map(k =>\n      this.tasks.set(k, this.tasks.get(k).bind(self))\n    );\n    return this;\n  }\n\n  async logEnvironment(taskName: string) {\n    const {\n      mongodb: { databaseName },\n      migrationsDir,\n      logger: { folder },\n      changelogCollectionName\n    } = this.configService.config;\n    console.log(`\n    \\nðŸ–¥ï¸  ${chalk.bold('Database:')} ${chalk.blue.bold(databaseName)}\n    \\nðŸ’¿  ${chalk.bold('DBCollection:')} ${chalk.blue.bold(\n      changelogCollectionName\n    )}\n    \\nðŸ—„ï¸  ${chalk.bold('LoggerDir:')} ${chalk.blue.bold(folder)}\n    \\nðŸ“  ${chalk.bold('MigrationsDir:')} ${chalk.blue.bold(migrationsDir)}\n    \\nðŸ‘·  ${chalk.bold('Script:')} ${chalk.blue.bold(\n      `xmigrate ${taskName}`\n    )}\n    `);\n  }\n}\n","import { Injectable } from '@rxdi/core';\nimport { MongoClient } from 'mongodb';\nimport { connect, ConnectionOptions } from 'mongoose';\nimport { ConfigService } from '../config/config.service';\n\n@Injectable()\nexport class DatabaseService {\n  constructor(private configService: ConfigService) {}\n  async connect() {\n    const url = this.configService.config.mongodb.url;\n    const databaseName = this.configService.config.mongodb.databaseName;\n    if (!url) {\n      throw new Error('No `url` defined in config file!');\n    }\n\n    if (!databaseName) {\n      throw new Error(\n        'No `databaseName` defined in config file! This is required since migrate-mongo v3. ' +\n          'See https://github.com/seppevs/migrate-mongo#initialize-a-new-project'\n      );\n    }\n\n    return (await MongoClient.connect(\n      url,\n      this.configService.config.mongodb.options\n    )).db(databaseName);\n  }\n\n  mongooseConnect(options?: ConnectionOptions) {\n    return connect(\n      `${this.configService.config.mongodb.url}/${\n        this.configService.config.mongodb.databaseName\n      }`,\n      options\n    );\n  }\n}\n","import { promisify } from 'util';\nimport { mkdir } from 'fs';\n\nexport async function ensureDir(dirpath: string) {\n  try {\n    await promisify(mkdir)(dirpath, { recursive: true });\n  } catch (err) {\n    if (err.code !== 'EEXIST') {\n      throw err;\n    }\n  }\n}\n","import { format } from 'date-fns';\n\nexport const now = (dateString = Date.now()) => {\n  const date = new Date(dateString);\n  return new Date(\n    date.getUTCFullYear(),\n    date.getUTCMonth(),\n    date.getUTCDate(),\n    date.getUTCHours(),\n    date.getUTCMinutes(),\n    date.getUTCSeconds(),\n    date.getUTCMilliseconds()\n  );\n};\n\nexport const nowAsString = () => format(now(), 'YYYYMMDDHHmmss');\n","export default `\nmodule.exports = {\n  async up (db) {\n    await db\n      .collection('albums')\n      .updateOne({ artist: 'The Beatles' }, { $set: { blacklisted: true } })\n    await db\n      .collection('albums')\n      .updateOne({ artist: 'The Doors' }, { $set: { stars: 5 } })\n  },\n\n  async down (db) {\n    await db\n      .collection('albums')\n      .updateOne({ artist: 'The Doors' }, { $set: { stars: 0 } })\n    await db\n      .collection('albums')\n      .updateOne({ artist: 'The Beatles' }, { $set: { blacklisted: false } })\n  }\n}\n`;\n","export default `\nmodule.exports = {\n  async up () {\n    return ['Up']\n  },\n\n  async down () {\n    return ['Down']\n  }\n}\n`;\n","export default `\nimport { Db } from 'mongodb';\n\nexport = {\n  async up(db: Db) {\n    await db\n      .collection('albums')\n      .updateOne({ artist: 'The Beatles' }, { $set: { blacklisted: true } });\n    await db\n      .collection('albums')\n      .updateOne({ artist: 'The Doors' }, { $set: { stars: 5 } });\n  },\n\n  async down(db: Db) {\n    await db\n      .collection('albums')\n      .updateOne({ artist: 'The Doors' }, { $set: { stars: 0 } });\n    await db\n      .collection('albums')\n      .updateOne({ artist: 'The Beatles' }, { $set: { blacklisted: false } });\n  }\n};\n`;\n","import native from './native';\nimport basic from './basic';\nimport typescript from './typescript';\n\nexport { basic, native, typescript };\nexport type TemplateTypes = 'basic' | 'native' | 'typescript';\n","import { Injectable } from '@rxdi/core';\nimport { MigrationSchema } from '../../injection.tokens';\nimport { readdir } from 'fs';\nimport { extname, join, isAbsolute } from 'path';\nimport { promisify } from 'util';\nimport { ConfigService } from '../config/config.service';\n\n@Injectable()\nexport class MigrationsResolver {\n  constructor(private configService: ConfigService) {}\n\n  async getFileNames() {\n    return (await promisify(readdir)(\n      this.configService.config.migrationsDir\n    )).filter(file => extname(file) === '.js');\n  }\n\n  loadMigration(fileName: string): MigrationSchema {\n    return require(join(\n      process.cwd(),\n      this.configService.config.migrationsDir,\n      fileName\n    ));\n  }\n\n  async resolve() {\n    if (isAbsolute(this.configService.config.migrationsDir)) {\n      return this.configService.config.migrationsDir;\n    }\n    return join(process.cwd(), this.configService.config.migrationsDir);\n  }\n}\n","import { ReturnType } from '../injection.tokens';\n\nexport class ErrorMap extends Error implements ReturnType {\n  fileName: string;\n  downgraded: ReturnType[];\n  appliedAt: string | Date;\n  result: unknown;\n  migrated: ReturnType[];\n}\n","import { DatabaseService } from '../database/database.service';\nimport { Injectable } from '@rxdi/core';\nimport { ensureDir } from '../../helpers/ensure-folder';\nimport { ReturnType } from '../../injection.tokens';\nimport { promisify } from 'util';\nimport { writeFile } from 'fs';\nimport { nowAsString } from '../../helpers/date';\nimport { TemplateTypes } from '../../templates/index';\nimport * as templates from '../../templates/index';\nimport { MigrationsResolver } from '../migrations-resolver/migrations-resolver.service';\nimport chalk from 'chalk';\nimport { normalize } from 'path';\nimport { LogFactory } from '../../helpers/log-factory';\nimport { ErrorMap } from '../../helpers/error';\nimport { ConfigService } from '../config/config.service';\n\n@Injectable()\nexport class MigrationService {\n  constructor(\n    private configService: ConfigService,\n    private database: DatabaseService,\n    private migrationsResolver: MigrationsResolver,\n    private logger: LogFactory\n  ) {}\n  async connect() {\n    await this.ensureFolders();\n    await this.database.mongooseConnect();\n    return this.database.connect();\n  }\n\n  async ensureFolders() {\n    await ensureDir(this.configService.config.logger.folder);\n    await ensureDir(this.configService.config.migrationsDir);\n  }\n\n  async up() {\n    const statusItems = await this.statusInternal();\n    const pendingItems = statusItems.filter(\n      item => item.appliedAt === 'PENDING'\n    );\n    const migrated = [];\n\n    const db = await this.connect();\n\n    const logger = this.logger.getUpLogger();\n\n    const migrateItem = async (item: ReturnType) => {\n      let result: unknown;\n      try {\n        const migration = await this.migrationsResolver.loadMigration(\n          item.fileName\n        );\n        result = await migration.up(db);\n      } catch (err) {\n        const error = new ErrorMap(err.message);\n        error.fileName = item.fileName;\n        error.migrated = migrated;\n        logger.error({\n          migrated,\n          errorMessage: error.message,\n          fileName: item.fileName\n        });\n        throw error;\n      }\n      const collection = db.collection(\n        this.configService.config.changelogCollectionName\n      );\n      const { fileName } = item;\n      const appliedAt = new Date();\n\n      try {\n        await collection.insertOne({ fileName, appliedAt });\n      } catch (err) {\n        logger.error({\n          migrated,\n          errorMessage: err.message,\n          fileName: item.fileName\n        });\n        throw new Error(`Could not update changelog: ${err.message}`);\n      }\n      const res = {\n        fileName: item.fileName,\n        appliedAt,\n        result\n      };\n      logger.log(res);\n      migrated.push(res);\n      return await true;\n    };\n    for (const item of pendingItems) {\n      await migrateItem(item);\n    }\n    this.printStatus(migrated);\n    return migrated;\n  }\n\n  async down() {\n    const downgraded = [];\n    const statusItems = await this.statusInternal();\n    const appliedItems = statusItems.filter(\n      item => item.appliedAt !== 'PENDING'\n    );\n    const lastAppliedItem = appliedItems[appliedItems.length - 1];\n    let result: unknown;\n\n    const logger = this.logger.getDownLogger();\n    const db = await this.connect();\n    if (lastAppliedItem) {\n      try {\n        const migration = this.migrationsResolver.loadMigration(\n          lastAppliedItem.fileName\n        );\n        result = await migration.down(db);\n      } catch (err) {\n        const error = new ErrorMap(err.message);\n        error.fileName = lastAppliedItem.fileName;\n        error.downgraded = downgraded;\n        logger.error({\n          downgraded,\n          errorMessage: err.message,\n          fileName: lastAppliedItem.fileName\n        });\n        throw error;\n      }\n      const collection = db.collection(\n        this.configService.config.changelogCollectionName\n      );\n      try {\n        await collection.deleteOne({ fileName: lastAppliedItem.fileName });\n        const res: ReturnType = {\n          fileName: lastAppliedItem.fileName,\n          appliedAt: new Date(),\n          result\n        };\n        logger.log(res);\n        downgraded.push(res);\n      } catch (err) {\n        logger.error({\n          downgraded,\n          errorMessage: err.message,\n          fileName: lastAppliedItem.fileName\n        });\n        throw new Error(`Could not update changelog: ${err.message}`);\n      }\n    }\n    this.printStatus(downgraded);\n    return result;\n  }\n\n  async createWithTemplate(template: TemplateTypes, name: string) {\n    if (!templates[template]) {\n      throw new Error(`ðŸ”¥  *** Missing template ${template} ***`);\n    }\n    const isTypescript = template === 'typescript';\n\n    const fileName = normalize(\n      `./${this.configService.config.migrationsDir}/${nowAsString()}-${name}.${\n        isTypescript ? 'ts' : 'js'\n      }`\n    );\n    await promisify(writeFile)(fileName, templates[template], {\n      encoding: 'utf-8'\n    });\n    return fileName;\n  }\n\n  async create({ name, template }) {\n    await this.ensureFolders();\n    const customTemplate =\n      template || this.configService.config.defaultTemplate;\n    const fileName = await this.createWithTemplate(customTemplate, name);\n    console.log(`\n\\nðŸš€  ${chalk.bold('Template:')} \"${chalk.blue(customTemplate)}\"!\n\\nðŸ’¾  ${chalk.bold('File:')} ${chalk.blue(\n      normalize(`${process.cwd()}//${fileName}`)\n    )}\n\\nðŸš€  ${chalk.green.bold('Migration template created!')}\n`);\n    process.exit(0);\n  }\n\n  private async statusInternal() {\n    const fileNames = await this.migrationsResolver.getFileNames();\n    const db = await this.connect();\n    const collection = db.collection<ReturnType>(\n      this.configService.config.changelogCollectionName\n    );\n    const changelog = await collection.find({}).toArray();\n    return fileNames.map((fileName: string) => {\n      const itemInLog = changelog.find(log => log.fileName === fileName);\n      const appliedAt = itemInLog\n        ? (itemInLog.appliedAt as any).toJSON()\n        : 'PENDING';\n      return { fileName, appliedAt, result: null } as ReturnType;\n    });\n  }\n\n  async status() {\n    const statusTable = await this.statusInternal();\n    this.printStatus(statusTable, 'table');\n    return {\n      status: true,\n      result: statusTable.filter(i => i.appliedAt === 'PENDING')\n    };\n  }\n\n  printStatus(status: ReturnType[], type?: 'table') {\n    if (type === 'table') {\n      return console.table(status, ['fileName', 'appliedAt']);\n    }\n    status.forEach((item, index) =>\n      console.log(`\n#ï¸âƒ£  ${chalk.white.bold(String(index + 1))}\n${chalk.blue('-'.repeat(process.stdout.columns))}\nðŸ“  ${chalk.bold(`Filename:`)} ${chalk.green(item.fileName)}\nâ±ï¸  ${chalk.bold(`Applied at:`)} ${chalk.green(String(item.appliedAt))}\n${chalk.blue('-'.repeat(process.stdout.columns))}\n    `)\n    );\n  }\n}\n","import { Tasks } from '../injection.tokens';\n\nexport const includes = (i: Tasks) => process.argv.toString().includes(i);\nexport const nextOrDefault = (i: Tasks, fb: any = true, type = (p) => (p)) => {\n    if (process.argv.toString().includes(i)) {\n        const isNextArgumentPresent = process.argv[process.argv.indexOf(i) + 1];\n        if (!isNextArgumentPresent) {\n            return fb;\n        }\n        if (isNextArgumentPresent.includes('--')) {\n            return fb;\n        }\n        return type(isNextArgumentPresent);\n    }\n    return fb;\n};","import { Config } from './injection.tokens';\n\nexport const DEFAULT_CONFIG: Config = {\n  changelogCollectionName: 'migrations',\n  migrationsDir: 'migrations',\n  logger: {\n    folder: './migrations-log',\n    up: {\n      success: 'up.success.log',\n      error: 'up.error.log'\n    },\n    down: {\n      success: 'down.success.log',\n      error: 'down.error.log'\n    }\n  },\n  mongodb: {\n    url: `mongodb://localhost:27017`,\n    databaseName: 'test',\n    options: {\n      useNewUrlParser: true\n    }\n  },\n  defaultTemplate: 'basic'\n};\n","import { Module, ModuleWithProviders } from '@rxdi/core';\nimport { GenericRunner } from './services/generic-runner/generic-runner.service';\nimport { LogFactory } from './helpers/log-factory';\nimport {\n  Config,\n  LoggerConfig,\n  CommandInjector,\n  Tasks\n} from './injection.tokens';\nimport { MigrationService } from './services/migration/migration.service';\nimport { nextOrDefault, includes } from './helpers/args-extractors';\nimport { DEFAULT_CONFIG } from './default.config';\nimport { join } from 'path';\nimport { ConfigService } from './services/config/config.service';\n\n@Module()\nexport class MigrationsModule {\n  public static forRoot(config: Config = DEFAULT_CONFIG): ModuleWithProviders {\n    return {\n      module: MigrationsModule,\n      providers: [\n        GenericRunner,\n        LogFactory,\n        {\n          provide: Config,\n          useValue: config\n        },\n        ConfigService,\n        {\n          provide: LoggerConfig,\n          useValue: config.logger\n        },\n        {\n          provide: LoggerConfig,\n          useValue: config.logger\n        },\n        {\n          provide: 'set-tasks',\n          deps: [GenericRunner, MigrationService],\n          useFactory: async (\n            runner: GenericRunner,\n            migrationService: MigrationService\n          ) => {\n            const tasks = [\n              ['up', migrationService.up],\n              ['down', migrationService.down],\n              ['status', migrationService.status],\n              ['create', migrationService.create]\n            ];\n            runner.setTasks(tasks);\n            runner.bind(migrationService);\n            return tasks;\n          }\n        },\n        {\n          provide: CommandInjector,\n          useFactory: () => {\n            const [, , ...args] = process.argv;\n            return {\n              command: args[0],\n              argv: args\n            };\n          }\n        },\n        {\n          provide: 'start',\n          deps: [CommandInjector, GenericRunner, ConfigService],\n          useFactory: async (\n            { command, argv }: { command: Tasks; argv: any[] },\n            runner: GenericRunner,\n            configService: ConfigService\n          ) => {\n            try {\n              configService.set(\n                await (require(join(process.cwd(), './xmigrate.js')) as (\n                  configService: ConfigService\n                ) => Promise<Config>)(configService)\n              );\n            } catch (e) {}\n            if (command === 'create') {\n              return runner.run(command, {\n                name: argv[1],\n                template: nextOrDefault('--template', null)\n              });\n            }\n            if (command === 'up') {\n              return runner.run(command, {\n                fallback: includes('--fallback')\n              });\n            }\n            return runner.run(command);\n          }\n        }\n      ]\n    };\n  }\n}\n","import { Module } from '@rxdi/core';\nimport { MigrationsModule } from './migrations.module';\n\n@Module({\n  imports: [MigrationsModule.forRoot()]\n})\nexport class AppModule {}\n","import { Bootstrap } from '@rxdi/core';\nimport { AppModule } from './app.module';\n\nBootstrap(AppModule).subscribe(() => {}, console.error.bind(console));\n"]}